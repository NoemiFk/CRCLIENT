<vex-page-layout mode="card">

  <vex-page-layout-header fxLayout="column" fxLayoutAlign="center start">
    <div>

      <h3>Paso 3. Segmentación del Portafolio</h3>
      <h6 class="mb-2"> 1. Asigna un nombre y descripcion al nuevo segmento.</h6>
      <h6 class="mb-2"> 2. Agrega un nuveo criterio de segmentacion (debe estar marcado en el mapeo del portafolio, se pueden combinar hasta tres criterios).</h6>
      <h6 class="mb-2"> 3. Crea el segmento con los registros indicados.</h6>
    
    </div>
  </vex-page-layout-header>

  <vex-page-layout-content vexContainer>
    <div class="card p-6">
      <h2 class="m-0 title mb-6">Información del Portafolio a Segmentar</h2>
      <div class="flex flex-col sm:flex-row" *ngIf="generalP">
        <table mat-table [dataSource]="generalP" class="mat-elevation-z8 text-center"  style="width: 100%;">

          <ng-container matColumnDef="Cliente">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>Financiera</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.cliente}} </b></td>
          </ng-container>
          <ng-container matColumnDef="Portafolio">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>Portafolio</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.portafolio}} </b></td>
          </ng-container>
          <ng-container matColumnDef="Registros">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>Registros</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.registros}} </b></td>
          </ng-container>
          <ng-container matColumnDef="Segmentación">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>Registros Segmentados</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.segmentadocant}} </b></td>
          </ng-container>
          <ng-container matColumnDef="segmentado">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b> % Segmentado</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.segmentado}} % </b></td>
          </ng-container>

          <ng-container matColumnDef="no_sgmentado">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>Registros No Segmentados</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.nosegmentadocant}} </b></td>
          </ng-container>
          <ng-container matColumnDef="porcentaje">
            <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>% no Segmentado</b>  </th>
            <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.nosegmentado}} % </b></td>
          </ng-container>
        
          <tr mat-header-row *matHeaderRowDef="displayedColumnsA2"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsA2;"></tr>
        </table>
      </div>
      <div class="flex flex-col sm:flex-row">
        <mat-form-field class="flex-auto mt-6">
          <mat-label>Nombre del nuevo Segmento (máximo 30 caracteres)</mat-label>
          <input cdkFocusInitial [(ngModel)]="segmentation.name" maxlength="30" matInput>
  
          <mat-icon [icIcon]="icPerson" class="mr-3" matPrefix></mat-icon>
        </mat-form-field>
        <mat-form-field class="flex-auto mt-6 ml-6">
          <mat-label>Descripción (máximo 100 caracteres)</mat-label>
          <input cdkFocusInitial [(ngModel)]="segmentation.description" maxlength="100"  matInput>
  
          <mat-icon [icIcon]="icPerson" class="mr-3" matPrefix></mat-icon>
        </mat-form-field>
      </div>
      <div class="flex flex-col sm:flex-row" *ngIf="segment">
        
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngFor="let seg of segment.segmentation let x=index" style="width: 30%;">
          <table mat-table [dataSource]="[seg]" class="mat-elevation-z8 text-center"  style="width: 100%;">

            <ng-container matColumnDef="SEGMENTO">
              <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>SEGMENTO</b>  </th>
              <td mat-cell *matCellDef="let element" class="text-center" > <a (click)="goto(x)"><b> {{element.name}} </b> </a></td>
            </ng-container>
            <ng-container matColumnDef="REGISTROS">
              <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>REGISTROS</b>  </th>
              <td mat-cell *matCellDef="let element" class="text-center" > <b> {{element.register}}</b></td>
            </ng-container>
            <ng-container matColumnDef="%">
              <th mat-header-cell *matHeaderCellDef class="text-center uppercase" style="background: rgb(1, 90, 167);"> <b>%</b>  </th>
              <td mat-cell *matCellDef="let element" class="text-center" > <b>  {{element.porcent | number : '1.1-1'}} <b>%</b>  </b></td>
            </ng-container>
          
            <tr mat-header-row *matHeaderRowDef="displayedColumnsC1"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsC1;"></tr>
          </table>
        </div>     
      </div>
      <div>
        <br>
        <h2 class="m-0 title mb-6">
            Selecciona los criterios de segmentación de los campos del mapeo que 
            se muestran a continuación haciendo clic en uno de los rangos propuestos 
            o define tus propios rangos.  Una vez seleccionado aparece en verde.
        </h2>
      </div>
      <div class="flex flex-col sm:flex-row mt-6" *ngIf="infoList.length && viewOptions">
        
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngFor="let info of infoList | slice:0:5;"  style="width: 30%;" [ngClass]="{'criteriaActive' : validCriterio(info.data) }" >
          <div class="container card-footer" style="font-size: 12px; ">
            <p><b>{{info.data}}</b></p>
            <ul style="overflow: scroll; height: 150px;">
              <li *ngFor="let data of info.datos" class="criterio" (click)="newCriteriaActual(info.data, data.A, data.B,info.register, info.filter)">
                <b >{{data.range}}</b>
                ({{data.count}})</li>
            </ul>
            <p class="mt-6"><b>Selecciona Rango:</b></p>
              <select  name="criterio1" [(ngModel)]="info.filter" class="h-6 w-8/12 mb-2" ><!--(selectionChange)="changeSegment($event)" -->
                <option value="rank"> Rango</option>
                <option value="higher"> Mayor que</option>
                <option value="less"> Menor que</option>
                <option value="equal"> Igual</option>
                <option value="exists"> Existe</option>
                <!--option [value]="option.data" *ngFor="let option of segmentacion;">{{option.data}}</option-->
              </select>
            <div class="flex flex-col sm:flex-row " *ngIf="infoList.length ">

              <input  *ngIf="info.filter!='rank'"  [(ngModel)]="info.rangeA" class="w-14 h-6"  (keydown)="onSearch1($event, info.data,info.register, info.filter,info)">
              <input  *ngIf="info.filter=='rank'"  [(ngModel)]="info.rangeA" class="w-14 h-6"  (keydown)="onSearch1($event, info.data,info.register, info.filter,info)">
              <input  *ngIf="info.filter=='rank'" [(ngModel)]="info.rangeB" class="ml-1 w-14 h-6"  (keydown)="onSearch1($event, info.data, info.register, info.filter,info)">
              <!--mat-icon [icIcon]="icAdd" class="mr-3" matPrefix></mat-icon-->
            </div>
          </div>
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=4"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=3"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=2"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=1"style="width: 30%;">
          -
        </div>
      </div>
      <div class="flex flex-col sm:flex-row mt-6" *ngIf="infoList.length>5 && viewOptions">
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngFor="let info of infoList | slice:5:10;" style="width: 30%;" [ngClass]="{'criteriaActive' : validCriterio(info.data) }">
          <div class="container card-footer" style="font-size: 12px; ">
            <p><b>{{info.data}}</b></p>
            <ul style="overflow: scroll; height: 150px;">
              <li *ngFor="let data of info.datos" class="criterio" (click)="newCriteriaActual(info.data, data.A, data.B,info.register,info.filter)">
                <b >{{data.range}}</b>
                ({{data.count}})</li>
            </ul>
            <p class="mt-6"><b>Selecciona Rango:</b></p>
            <select  name="criterio1" [(ngModel)]="info.filter" class="h-6 w-8/12 mb-2" ><!--(selectionChange)="changeSegment($event)" -->
              <option value="rank"> Rango</option>
              <option value="higher"> Mayor que</option>
              <option value="less"> Menor que</option>
              <option value="equal"> Igual</option>
              <option value="exists"> Existe</option>
              <!--option [value]="option.data" *ngFor="let option of segmentacion;">{{option.data}}</option-->
            </select>
          <div class="flex flex-col sm:flex-row " *ngIf="infoList.length">

            <input  *ngIf="info.filter!='rank'"  [(ngModel)]="info.rangeA" class="w-14 h-6"  (keydown)="onSearch1($event, info.data,info.register, info.filter,info)">
            <input  *ngIf="info.filter=='rank'"  [(ngModel)]="info.rangeA" class="w-14 h-6"  (keydown)="onSearch1($event, info.data,info.register, info.filter,info)">
            <input  *ngIf="info.filter=='rank'" [(ngModel)]="info.rangeB" class="ml-1 w-14 h-6"  (keydown)="onSearch1($event, info.data, info.register, info.filter,info)">
            <!--mat-icon [icIcon]="icAdd" class="mr-3" matPrefix></mat-icon-->
          </div>
          </div>
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=9"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=8"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=7"style="width: 30%;">
          -
        </div>
        <div class="flex flex-auto flex-col mr-2 ml-2" *ngIf="infoList.length<=6"style="width: 30%;">
          -
        </div>
      </div>
      <br>
      <br>
      
      
      <div *ngFor="let option of segmentation.criteria;  let i = index; ">
       

        <div class="flex flex-col sm:flex-row mt-6" >
          
          <div class="flex flex-auto align-items-center"> <b>Criterio {{i+1}}</b></div>
          <div class="flex flex-auto align-items-center">
            <b> {{option.name}}   </b> 
            
          </div>
          <div class="flex flex-auto align-items-center">
            <button class="ml-6" (click)="delete(i)" color="warn" mat-flat-button  type="submit">ELIMINAR CRITERIO</button>

            <!--a (click)="delete(i)"
            class="w-8 h-8 leading-none flex items-center justify-center hover:bg-hover text-warn bg-warn-light"
            mat-icon-button matTooltip="Eliminar Criterio">
            <mat-icon [icIcon]="icDelete" size="18px"></mat-icon>
          </a-->
          </div>
          <div class="flex flex-auto">

          </div>
          <div class="flex flex-auto">
            <table mat-table [dataSource]="option.dataSeg" class="mat-elevation-z8 text-center " style="width: 100%;">
        
              <ng-container matColumnDef="Registros">
                <th mat-header-cell *matHeaderCellDef class="text-center uppercase " style="background: rgb(1, 90, 167);"> <b class="text-xs">Registros</b> </th>
                <td mat-cell *matCellDef="let element"> {{element.actual}} </td>
              </ng-container>
              <ng-container matColumnDef="Datos_Segmentados">
                <th mat-header-cell *matHeaderCellDef class="text-center uppercase " style="background: rgb(1, 90, 167);"> <b class="text-xs">Segmentados</b> </th>
                <td mat-cell *matCellDef="let element"> {{element.info}} </td>
              </ng-container>
              <ng-container matColumnDef="Porcentaje">
                <th mat-header-cell *matHeaderCellDef class="text-center uppercase " style="background: rgb(1, 90, 167);"> <b class="text-xs">Porcentaje</b> </th>
                <td mat-cell *matCellDef="let element"> {{element.porcent}} %</td>
              </ng-container>
              <ng-container matColumnDef="No_Segmentados">
                <th mat-header-cell *matHeaderCellDef class="text-center uppercase " style="background: rgb(1, 90, 167);"> <b class="text-xs">No Segmentados</b> </th>
                <td mat-cell *matCellDef="let element"> {{element.register}} </td>
              </ng-container>
            
              <tr mat-header-row *matHeaderRowDef="displayedColumnsSEG"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsSEG"></tr>
            </table>
          </div>
        </div>
        
        
      </div>
      <br>
      <div>
        <mat-checkbox class="example-margin w-full text-center"
        
        [(ngModel)]="rest_assigned"
        >
        Deseas asignar la información no segmentada a este segmento ?
      </mat-checkbox>
      </div>
      <br>
      <div align="center">
        <!--button  (click)="create()" mat-flat-button mat-button color="primary" mat-button type="submit" [disabled]="!segmentation.name">GUARDAR SEGMENTACIÓN</button-->
      <!--a (click)="newCriteria()" color="primary" mat-stroked-button  *ngIf="AddCriteria">AGREGAR NUERVO CRITERIO</a-->
      <!--button class="ml-6" (click)="create()" color="accent" mat-stroked-button type="submit" >GUARDAR SEGMENTACIÓN</button-->
      <!--button *ngIf="isEdit" class="ml-6" (click)="create()"color="accent" mat-stroked-button type="submit">EDITAR SEGMENTACIÓN</button-->
    
     
      </div>
      <div align="end">
        <button (click)="return()" color="warn"  mat-button  type="button">CANCELAR</button>
        <button class="ml-6" (click)="deleteSeg()"color="warn" mat-flat-button  type="submit">ELIMINAR SEGMENTACIÓN</button>
        <button class="ml-6"  (click)="create()" mat-flat-button mat-button color="primary" mat-button type="submit" [disabled]="!segmentation.name">GUARDAR SEGMENTACIÓN</button>
     
        <!--button *ngIf="isNew" class="ml-6" (click)="create()"color="primary" mat-stroked-button type="submit">CREAR SEGMENTACIÓN</button>
        <button *ngIf="isEdit" class="ml-6" (click)="create()"color="primary" mat-stroked-button type="submit">EDITAR SEGMENTACIÓN</button-->
      </div>
    </div>
  </vex-page-layout-content>

</vex-page-layout>