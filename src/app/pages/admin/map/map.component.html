<vex-page-layout>

  <vex-page-layout-header class="pb-16" fxLayout="column" fxLayoutAlign="center start">
    <div [class.container]="layoutCtrl.value === 'boxed'"
         [class.px-gutter]="layoutCtrl.value === 'fullwidth'"
         class="w-full flex flex-col  justify-between"> <!-- sm:flex-row-->
      <h2>Mapeo</h2>
      <p>Sube aquí tu carteta de clientes morosos, actualizar y realiza el mapeo a tu preferencia.</p>
    </div>
  </vex-page-layout-header>

  <vex-page-layout-content [class.container]="layoutCtrl.value === 'boxed'"
                           [class.px-gutter]="layoutCtrl.value === 'fullwidth'"
                           class="-mt-6">

    <div class="card overflow-auto -mt-16" *ngIf="isNew=='true'">

          <mat-horizontal-stepper>
            <mat-step label="Cargar Archivo" state="phone">
              <div style="padding: 20px;">

                <h3>Cargar Archivo</h3>
                <p>Carga aquí tu layout</p>
              </div>
              <div  class="text-center">
      
                <input type="file" (change)="onFileChange($event)" />
                <h3 *ngIf="jsonData.Datos.length">Datos Cargados</h3>
                <h2 *ngIf="jsonData.Datos.length"> {{jsonData.Datos.length}}</h2>
              <!--div id="output"></div>
                <br>
                <div *ngIf="willDownload">
                  <a id="download"> Download JSON File </a>
                </div-->
                
            </div>
              <div class="text-right" *ngIf="jsonData.Datos.length">
                <button mat-button matStepperNext>Siguiente</button>
              </div>
            </mat-step>
            <mat-step label="Vista Previa" state="chat">
              <br>
              <p>Visualizar aquí los datos cargados.</p>
              <br>
              <div class="card overflow-auto" style="max-height: 500px;">
                <div class="bg-app-bar px-6 h-16 border-b sticky left-0" fxLayout="row" fxLayoutAlign="start center">
                  <h2 class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l" fxFlex="none" fxHide.xs>
                    <span *ngIf="selection.isEmpty()">Cartera</span>
                    <span *ngIf="selection.hasValue()">{{ selection.selected.length }}
                      Cartera<span *ngIf="selection.selected.length > 1">s</span> seleccionadas</span>
                  </h2>
            
                  <div *ngIf="selection.hasValue()" class="mr-4 pr-4 border-r" fxFlex="none">
                    <button (click)="deleteCustomers(selection.selected)"
                            color="primary"
                            mat-icon-button
                            matTooltip="Eliminar selecionados"
                            type="button">
                      <mat-icon [icIcon]="icDelete"></mat-icon>
                    </button>
            
                    <button color="primary" mat-icon-button matTooltip="Descargar" type="button">
                      <mat-icon [icIcon]="icFolder"></mat-icon>
                    </button>
                  </div>
            
                  <div class="bg-card rounded-full border px-4"
                       fxFlex="400px"
                       fxFlex.lt-md="auto"
                       fxHide.xs
                       fxLayout="row"
                       fxLayoutAlign="start center">
                    <ic-icon [icIcon]="icSearch" size="20px"></ic-icon>
                    <input [formControl]="searchCtrl"
                           class="px-4 py-3 border-0 outline-none w-full bg-transparent"
                           placeholder="Search..."
                           type="search">
                  </div>
            
                  <span fxFlex></span>
            
                  <button class="ml-4" fxFlex="none" fxHide.gt-xs mat-icon-button type="button">
                    <mat-icon [icIcon]="icSearch"></mat-icon>
                  </button>
            
                  <button [matMenuTriggerFor]="columnFilterMenu"
                          class="ml-4"
                          fxFlex="none"
                          mat-icon-button
                          matTooltip="Filter Columns"
                          type="button">
                    <mat-icon [icIcon]="icFilterList"></mat-icon>
                  </button>
            
                </div>
                <table @stagger [dataSource]="jsDatos" class="w-full" mat-table matSort *ngIf="uploadActive">

                  <!--- Note that these columns can be defined in any order.
                        The actual rendered columns are set as a property on the row definition" -->
            
               
            
                  <!-- Text Columns -->
                  <ng-container *ngFor="let column of columns; trackBy: trackByProperty">
                    <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                      <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> {{ column.label }}</th>
                      <td *matCellDef="let row" [ngClass]="column.cssClasses" mat-cell>{{ row[column.property] }}</td>
                    </ng-container>
                  </ng-container>
            
            
                  <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
                  <tr (click)="updateCustomer(row)"
                      *matRowDef="let row; columns: visibleColumns;"
                      @fadeInUp
                      class="hover:bg-hover trans-ease-out cursor-pointer"
                      mat-row></tr>
                </table>
              </div>
              <br>
              <div class="text-right">
                <button mat-button matStepperPrevious>Atras</button>
                <button mat-button matStepperNext (click)="createRegister()">Cargar Archivo</button>
              </div>
            </mat-step>
            <mat-step label="Mapeo">

              <br>
              <p>Selecciona en la siguiente tabla los datos que desees utilizar en los siguientes procesos de Collections Robot.</p>
              <br>
              <div class="card overflow-auto" style="max-height: 500px;">
                <div class="my-12 container"
                fxLayout="row"
                fxLayout.xs="column"
                fxLayoutAlign="start start"
                fxLayoutAlign.xs="start stretch"
                fxLayoutGap="24px">
                <div  fxFlex fxLayout="column">
                  <b>Dato</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of map"> {{column.datos}}</mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Ejemplo</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of map"> {{column.ejemplo}}</mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Análisis</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of analysis"> 
                      <mat-checkbox class="example-margin"
                      
                      [(ngModel)]="column.status">
                    </mat-checkbox>
                    </mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Segmentación</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of segmentation"> 
                      <mat-checkbox class="example-margin"
                      
                      [(ngModel)]="column.status"
                      >
                    </mat-checkbox>
                    </mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Comunicación</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of strategies"> 
                      <mat-checkbox class="example-margin"
                      
                      [(ngModel)]="column.status"
                      >
                    </mat-checkbox>
                    </mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Portal</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of customerPortal"> 
                      <mat-checkbox class="example-margin"
                      
                      [(ngModel)]="column.status"
                      >
                    </mat-checkbox>
                    </mat-list-item>
                  </mat-list>
                </div>
                <div  fxFlex fxLayout="column">
                  <b>Validación</b>
                  <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let column of validations"> 
                      <mat-checkbox class="example-margin"
                      
                      [(ngModel)]="column.status"
                      >
                    </mat-checkbox>
                      <select class="sm:ml-6" name="type"  >
                        <option value="no">Seleccione uno...</option>
                        <option value="Email">E-mail</option>
                        <option value="number">Numero Telefonico</option>
                        <option value="date">Fecha</option>
                      </select>
                    </mat-list-item>
                  </mat-list>
                </div>
                </div>
              </div>
              <div class="text-right">
                <button mat-button matStepperPrevious>Atras</button>
                <button mat-button matStepperNext (click)="create()">Cargar Archivo</button>
              </div>
            </mat-step>
          
            <!-- Icon overrides. -->
            <ng-template matStepperIcon="phone">
              <mat-icon>call_end</mat-icon>
            </ng-template>
            <ng-template matStepperIcon="chat">
              <mat-icon>forum</mat-icon>
            </ng-template>
          </mat-horizontal-stepper>

    <!--div class="bg-app-bar px-6 h-16 border-b sticky left-0" fxLayout="row" fxLayoutAlign="start center">
      <h2 class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l" fxFlex="none" fxHide.xs>
        <span *ngIf="selection.isEmpty()">Cartera</span>
        <span *ngIf="selection.hasValue()">{{ selection.selected.length }}
          Cartera<span *ngIf="selection.selected.length > 1">s</span> seleccionadas</span>
      </h2>

      <div *ngIf="selection.hasValue()" class="mr-4 pr-4 border-r" fxFlex="none">
        <button (click)="deleteCustomers(selection.selected)"
                color="primary"
                mat-icon-button
                matTooltip="Eliminar selecionados"
                type="button">
          <mat-icon [icIcon]="icDelete"></mat-icon>
        </button>

        <button color="primary" mat-icon-button matTooltip="Descargar" type="button">
          <mat-icon [icIcon]="icFolder"></mat-icon>
        </button>
      </div>

      <div class="bg-card rounded-full border px-4"
           fxFlex="400px"
           fxFlex.lt-md="auto"
           fxHide.xs
           fxLayout="row"
           fxLayoutAlign="start center">
        <ic-icon [icIcon]="icSearch" size="20px"></ic-icon>
        <input [formControl]="searchCtrl"
               class="px-4 py-3 border-0 outline-none w-full bg-transparent"
               placeholder="Search..."
               type="search">
      </div>

      <span fxFlex></span>

      <button class="ml-4" fxFlex="none" fxHide.gt-xs mat-icon-button type="button">
        <mat-icon [icIcon]="icSearch"></mat-icon>
      </button>

      <button [matMenuTriggerFor]="columnFilterMenu"
              class="ml-4"
              fxFlex="none"
              mat-icon-button
              matTooltip="Filter Columns"
              type="button">
        <mat-icon [icIcon]="icFilterList"></mat-icon>
      </button>

      <button (click)="createMapeo()"
              class="ml-4"
              color="primary"
              fxFlex="none"
              mat-mini-fab
              matTooltip="Generar Mapeo"
              type="button">
        <mat-icon [icIcon]="icAdd"></mat-icon>
      </button>
      <button (click)="upload()"
              class="ml-4"
              color="primary"
              fxFlex="none"
              mat-mini-fab
              matTooltip="Cargar Archivo"
              type="button">
        <mat-icon [icIcon]="icUpload"></mat-icon>
      </button>
      <button (click)="load()"
              class="ml-4"
              color="warn"
              fxFlex="none"
              mat-mini-fab
              matTooltip="Actualizar Cartera"
              type="button">
        <mat-icon [icIcon]="icLoad"></mat-icon>
      </button>
    </div-->
    
    
    </div>
    <div class="card overflow-auto -mt-16" *ngIf="isNew=='false'">
      <div>
        <h2>Fecha de creacion: <b> 24-Febrero-2021</b></h2>
        <h2>Fecha de actualizacion: <b>--</b></h2>
      </div>
      <mat-horizontal-stepper>
        <mat-step label="Cartera Activa" state="chat">
          <br>
          <p>Cartera Activa mapeada en el portafolio</p>
          <br>
          <div class="card overflow-auto" style="max-height: 500px;">
            <div class="bg-app-bar px-6 h-16 border-b sticky left-0" fxLayout="row" fxLayoutAlign="start center">
              <h2 class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l" fxFlex="none" fxHide.xs>
                <span *ngIf="selection.isEmpty()">Cartera</span>
                <span *ngIf="selection.hasValue()">{{ selection.selected.length }}
                  Cartera<span *ngIf="selection.selected.length > 1">s</span> seleccionadas</span>
              </h2>
        
              <div *ngIf="selection.hasValue()" class="mr-4 pr-4 border-r" fxFlex="none">
                <button (click)="deleteCustomers(selection.selected)"
                        color="primary"
                        mat-icon-button
                        matTooltip="Eliminar selecionados"
                        type="button">
                  <mat-icon [icIcon]="icDelete"></mat-icon>
                </button>
        
                <button color="primary" mat-icon-button matTooltip="Descargar" type="button">
                  <mat-icon [icIcon]="icFolder"></mat-icon>
                </button>
              </div>
        
              <div class="bg-card rounded-full border px-4"
                   fxFlex="400px"
                   fxFlex.lt-md="auto"
                   fxHide.xs
                   fxLayout="row"
                   fxLayoutAlign="start center">
                <ic-icon [icIcon]="icSearch" size="20px"></ic-icon>
                <input [formControl]="searchCtrl"
                       class="px-4 py-3 border-0 outline-none w-full bg-transparent"
                       placeholder="Search..."
                       type="search">
              </div>
        
              <span fxFlex></span>
        
              <button class="ml-4" fxFlex="none" fxHide.gt-xs mat-icon-button type="button">
                <mat-icon [icIcon]="icSearch"></mat-icon>
              </button>
        
              <button [matMenuTriggerFor]="columnFilterMenu"
                      class="ml-4"
                      fxFlex="none"
                      mat-icon-button
                      matTooltip="Filter Columns"
                      type="button">
                <mat-icon [icIcon]="icFilterList"></mat-icon>
              </button>
        
            </div>
            <table @stagger [dataSource]="dataSourceUpload" class="w-full" mat-table matSort>

              <!--- Note that these columns can be defined in any order.
                    The actual rendered columns are set as a property on the row definition" -->
        
           
        
              <!-- Text Columns -->
              <ng-container *ngFor="let column of columns; trackBy: trackByProperty">
                <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                  <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> {{ column.label }}</th>
                  <td *matCellDef="let row" [ngClass]="column.cssClasses" mat-cell>{{ row[column.property] }}</td>
                </ng-container>
              </ng-container>
        
        
              <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
              <tr (click)="updateCustomer(row)"
                  *matRowDef="let row; columns: visibleColumns;"
                  @fadeInUp
                  class="hover:bg-hover trans-ease-out cursor-pointer"
                  mat-row></tr>
            </table>
          </div>
          <br>
          <div class="text-right">
            <button mat-button matStepperPrevious>Atras</button>
            <button mat-button matStepperNext (click)="createRegister()">Cargar Archivo</button>
          </div>
        </mat-step>
        <mat-step label="Actualizar Cartera" state="phone">
          <div style="padding: 20px;">

            <h3>Cargar Archivo</h3>
            <p>Carga aquí tu layout</p>
          </div>
          <div  class="text-center">
  
            <input type="file" (change)="onFileChange($event)" />
            <h3 *ngIf="jsonData.Datos.length">Datos Cargados</h3>
            <h2 *ngIf="jsonData.Datos.length"> {{jsonData.Datos.length}}</h2>
          <!--div id="output"></div>
            <br>
            <div *ngIf="willDownload">
              <a id="download"> Download JSON File </a>
            </div-->
            
        </div>
          <div class="text-right" *ngIf="jsonData.Datos.length">
            <button mat-button matStepperNext>Siguiente</button>
          </div>
        </mat-step>
        <mat-step label="Vista Previa" state="chat">
          <br>
          <p>Visualizar aquí los datos cargados.</p>
          <br>
          <div class="card overflow-auto" style="max-height: 500px;">
            <div class="bg-app-bar px-6 h-16 border-b sticky left-0" fxLayout="row" fxLayoutAlign="start center">
              <h2 class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l" fxFlex="none" fxHide.xs>
                <span *ngIf="selection.isEmpty()">Cartera</span>
                <span *ngIf="selection.hasValue()">{{ selection.selected.length }}
                  Cartera<span *ngIf="selection.selected.length > 1">s</span> seleccionadas</span>
              </h2>
        
              <div *ngIf="selection.hasValue()" class="mr-4 pr-4 border-r" fxFlex="none">
                <button (click)="deleteCustomers(selection.selected)"
                        color="primary"
                        mat-icon-button
                        matTooltip="Eliminar selecionados"
                        type="button">
                  <mat-icon [icIcon]="icDelete"></mat-icon>
                </button>
        
                <button color="primary" mat-icon-button matTooltip="Descargar" type="button">
                  <mat-icon [icIcon]="icFolder"></mat-icon>
                </button>
              </div>
        
              <div class="bg-card rounded-full border px-4"
                   fxFlex="400px"
                   fxFlex.lt-md="auto"
                   fxHide.xs
                   fxLayout="row"
                   fxLayoutAlign="start center">
                <ic-icon [icIcon]="icSearch" size="20px"></ic-icon>
                <input [formControl]="searchCtrl"
                       class="px-4 py-3 border-0 outline-none w-full bg-transparent"
                       placeholder="Search..."
                       type="search">
              </div>
        
              <span fxFlex></span>
        
              <button class="ml-4" fxFlex="none" fxHide.gt-xs mat-icon-button type="button">
                <mat-icon [icIcon]="icSearch"></mat-icon>
              </button>
        
              <button [matMenuTriggerFor]="columnFilterMenu"
                      class="ml-4"
                      fxFlex="none"
                      mat-icon-button
                      matTooltip="Filter Columns"
                      type="button">
                <mat-icon [icIcon]="icFilterList"></mat-icon>
              </button>
        
            </div>
            <table @stagger [dataSource]="jsDatos" class="w-full" mat-table matSort *ngIf="uploadActive">

              <!--- Note that these columns can be defined in any order.
                    The actual rendered columns are set as a property on the row definition" -->
        
           
        
              <!-- Text Columns -->
              <ng-container *ngFor="let column of columns; trackBy: trackByProperty">
                <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                  <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header> {{ column.label }}</th>
                  <td *matCellDef="let row" [ngClass]="column.cssClasses" mat-cell>{{ row[column.property] }}</td>
                </ng-container>
              </ng-container>
        
        
              <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
              <tr (click)="updateCustomer(row)"
                  *matRowDef="let row; columns: visibleColumns;"
                  @fadeInUp
                  class="hover:bg-hover trans-ease-out cursor-pointer"
                  mat-row></tr>
            </table>
          </div>
          <br>
          <div class="text-right">
            <button mat-button matStepperPrevious>Atras</button>
            <button mat-button matStepperNext (click)="createRegister()">Cargar Archivo</button>
          </div>
        </mat-step>
        <mat-step label="Mapeo">

          <br>
          <p>Selecciona en la siguiente tabla los datos que desees utilizar en los siguientes procesos de Collections Robot.</p>
          <br>
          <div class="card overflow-auto" style="max-height: 500px;">
            <div class="my-12 container"
            fxLayout="row"
            fxLayout.xs="column"
            fxLayoutAlign="start start"
            fxLayoutAlign.xs="start stretch"
            fxLayoutGap="24px">
            <div  fxFlex fxLayout="column">
              <b>Dato</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of map"> {{column.datos}}</mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Ejemplo</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of map"> {{column.ejemplo}}</mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Análisis</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of analysis"> 
                  <mat-checkbox class="example-margin"
                  
                  [(ngModel)]="column.status">
                </mat-checkbox>
                </mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Segmentación</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of segmentation"> 
                  <mat-checkbox class="example-margin"
                  
                  [(ngModel)]="column.status"
                  >
                </mat-checkbox>
                </mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Comunicación</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of strategies"> 
                  <mat-checkbox class="example-margin"
                  
                  [(ngModel)]="column.status"
                  >
                </mat-checkbox>
                </mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Portal</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of customerPortal"> 
                  <mat-checkbox class="example-margin"
                  
                  [(ngModel)]="column.status"
                  >
                </mat-checkbox>
                </mat-list-item>
              </mat-list>
            </div>
            <div  fxFlex fxLayout="column">
              <b>Validación</b>
              <mat-list role="list">
                <mat-list-item role="listitem" *ngFor="let column of validations"> 
                  <mat-checkbox class="example-margin"
                  
                  [(ngModel)]="column.status"
                  >
                </mat-checkbox>
                  <select class="sm:ml-6" name="type"  >
                    <option value="no">Seleccione uno...</option>
                    <option value="Email">E-mail</option>
                    <option value="number">Numero Telefonico</option>
                    <option value="date">Fecha</option>
                  </select>
                </mat-list-item>
              </mat-list>
            </div>
            </div>
          </div>
          <div class="text-right">
            <button mat-button matStepperPrevious>Atras</button>
            <button mat-button matStepperNext (click)="create()">Grabar</button>
          </div>
        </mat-step>
        <mat-step label="Validar Cartera" state="phone">
          <div style="padding: 20px;" class="text-center">
            <button>Validar</button>
        </div>
          <div class="text-right" *ngIf="jsonData.Datos.length">
            <button mat-button matStepperNext>Siguiente</button>
          </div>
        </mat-step>
        
      
        <!-- Icon overrides. -->
        <ng-template matStepperIcon="phone">
          <mat-icon>call_end</mat-icon>
        </ng-template>
        <ng-template matStepperIcon="chat">
          <mat-icon>forum</mat-icon>
        </ng-template>
      </mat-horizontal-stepper>
    </div>

  </vex-page-layout-content>

</vex-page-layout>

<mat-menu #columnFilterMenu="matMenu" xPosition="before" yPosition="below">
  <button (click)="toggleColumnVisibility(column, $event)" *ngFor="let column of columns"
          class="checkbox-item mat-menu-item">
    <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="column.visible" color="primary">
      {{ column.label }}
    </mat-checkbox>
  </button>
</mat-menu>

<mat-menu #actionsMenu="matMenu" xPosition="before" yPosition="below">
  <ng-template let-customer="customer" matMenuContent>
    <button (click)="updateCustomer(customer)" mat-menu-item>
      <mat-icon [icIcon]="icEdit"></mat-icon>
      <span>Modificar</span>
    </button>
    <button (click)="deleteCustomer(customer)" mat-menu-item>
      <mat-icon [icIcon]="icDelete"></mat-icon>
      <span>Eliminar</span>
    </button>
  </ng-template>
</mat-menu>
